flowchart LR
    UI["FastAPI UI<br/>(templates)"] --> Coordinator[CoordinatorAgent]
    Coordinator --> Graph[LangGraph Orchestration]

    Graph --> Parser[ParserAgent]
    Graph --> Cost[CostAgent]
    Graph --> Reliability[ReliabilityAgent]
    Graph --> Security[SecurityAgent]

    Parser -->|CanonicalConfig| Graph
    Parser -. "Parse failure -> stop analysis" .-> Aggregate

    Cost -->|Issues/Signals| Aggregate[Aggregator / Report Builder]
    Reliability -->|Issues| Aggregate
    Security -->|Issues| Aggregate
    Graph --> Aggregate

    Aggregate --> Report[AnalysisReport]
    Report --> UI

    MCP["Local MCP-style Tools<br/>(deterministic, read-only)"] --- Parser
    MCP --- Cost

    Contracts[Pydantic Contracts] --- Parser
    Contracts --- Cost
    Contracts --- Reliability
    Contracts --- Security
    Contracts --- Aggregate
    Contracts --- Report

    Report --> LLM["Optional LLM Explainer<br/>(Groq)"] --> AISummary["AI Summary<br/>(explain-only)"] --> UI

    Note["Findings are deterministic;<br/>LLM is explain-only"] -.-> LLM
